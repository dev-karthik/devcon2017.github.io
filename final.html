<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>

<title>WordDuniya Game</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="cache-control" content="max-age=0" />
<meta http-equiv="cache-control" content="no-cache" />
<meta http-equiv="Cache-Control" content="no-store" />
<meta http-equiv="pragma" content="no-cache" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.100.2/css/materialize.min.css">
<script src="https://use.fontawesome.com/8f8cd7f5fa.js"></script>
<link rel="stylesheet" href="./css/buttons.css">
<style>
  .bodyGradient{

/*background: #29323c;  
background: -webkit-linear-gradient(to right, #485563, #29323c); 
background: linear-gradient(to right, #485563, #29323c);
background: #757F9A; 
background: -webkit-linear-gradient(to right, #D7DDE8, #757F9A); 
background: linear-gradient(to right, #D7DDE8, #757F9A); */
        background: #1c92d2;  /* fallback for old browsers */
        background: -webkit-linear-gradient(to right, #f2fcfe, #1c92d2);  /* Chrome 10-25, Safari 5.1-6 */
        background: linear-gradient(to right, #f2fcfe, #1c92d2); /* W3C, IE 10+/ Edge, Firefox 16+, Chrome 26+, Opera 12+, Safari 7+ */
   }

  .card .card-title {
    font-size: 18px !important;
  }
     
  #start_button {
    border: 0;
    background-color:transparent;
    padding: 0;
  }
  .center {
    padding: 10px;
    text-align: center;
  }
  .right {
    float: right;
  }
  .left {
    float: left;
  }

  #textarea {
    height: 90px;
    font-family: Tahoma, sans-serif;
    color: #333637;
    font-size: 20px;
    min-height: 90px;
    text-align: center;
  }

  #start_button {
    border: 0;
    background-color:transparent;
    padding: 0;
  }

  #text{
      position: absolute;
      top: 25%;
      left: 50%;
      font-size: 50px;
      color: white;
      transform: translate(-50%,-50%);
      -ms-transform: translate(-50%,-50%);
  }

  #record_button{
      position: absolute;
      top: 50%;
      left: 50%;
      font-size: 50px;
      color: white;
      transform: translate(-50%,-50%);
      -ms-transform: translate(-50%,-50%);
  }

  .cards-container {
    column-break-inside: avoid;
  }
  .cards-container .card {
    display: inline-block;
    overflow: visible;
  }

  @media only screen and (max-width: 600px) {
    .cards-container {
      -webkit-column-count: 1;
      -moz-column-count: 1;
      column-count: 1;
    }
  }
  @media only screen and (min-width: 601px) {
    .cards-container {
      -webkit-column-count: 2;
      -moz-column-count: 2;
      column-count: 2;
    }
  }
  @media only screen and (min-width: 993px) {
    .cards-container {
      -webkit-column-count: 3;
      -moz-column-count: 3;
      column-count: 3;
    }
  }
  .text-center {
    text-align: center;
  }

  #overlay {
      position: fixed;
      display: none;
      width: 100%;
      height: 100%;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(0,0,0,0.8);
      z-index: 2;
      cursor: pointer;
  }

  #preloader_1{
      position: absolute;
      top: 50%;
      left: 47%;
      background:#ECF0F1;
      font-size: 50px;
      color: white;
      transform: translate(-50%,-50%);
      -ms-transform: translate(-50%,-50%);
  }


  #preloader_1 span{
    display:block;
    bottom:0px;
    width: 9px;
    height: 5px;
    background:#9b59b6;
    position:absolute;
    -webkit-animation: preloader_1 1.5s  infinite ease-in-out;
    -moz-animation: preloader_1 1.5s   infinite ease-in-out;
    -ms-animation: preloader_1 1.5s  infinite ease-in-out;
    -o-animation: preloader_1 1.5s   infinite ease-in-out;
    animation: preloader_1 1.5s  infinite ease-in-out;

  }

  #preloader_1 span:nth-child(2){
      left:11px;
      -webkit-animation-delay: .2s;
      -moz-animation-delay: .2s;
      -ms-animation-delay: .2s;
      -o-animation-delay: .2s;
      animation-delay: .2s;

  }
  #preloader_1 span:nth-child(3){
      left:22px;
      -webkit-animation-delay: .4s;
      -moz-animation-delay: .4s;
      -ms-animation-delay: .4s;
      -o-animation-delay: .4s;
      animation-delay: .4s;
  }
  #preloader_1 span:nth-child(4){
      left:33px;
      -webkit-animation-delay: .6s;
      -moz-animation-delay: .6s;
      -ms-animation-delay: .6s;
      -o-animation-delay: .6s;
      animation-delay: .6s;
  }
  #preloader_1 span:nth-child(5){
      left:44px;
      -webkit-animation-delay: .8s;
      -moz-animation-delay: .8s;
      -ms-animation-delay: .8s;
      -o-animation-delay: .8s;
      animation-delay: .8s;
  }
  #preloader_1 span:nth-child(6){
      left:55px;
      -webkit-animation-delay: 1s;
      -moz-animation-delay: 1s;
      -ms-animation-delay: 1s;
      -o-animation-delay: 1s;
      animation-delay: 1s;
  }
  #preloader_1 span:nth-child(7){
      left:66px;
      -webkit-animation-delay: 1.2s;
      -moz-animation-delay: 1.2s;
      -ms-animation-delay: 1.2s;
      -o-animation-delay: 1.2s;
      animation-delay: 1.2s;
  }
  @-webkit-keyframes preloader_1 {
      0% {height:5px;-webkit-transform:translateY(0px);background:#9b59b6;}
      25% {height:30px;-webkit-transform:translateY(15px);background:#3498db;}
      50% {height:5px;-webkit-transform:translateY(0px);background:#9b59b6;}
      100% {height:5px;-webkit-transform:translateY(0px);background:#9b59b6;}
  }

  @-moz-keyframes preloader_1 {
      0% {height:5px;-moz-transform:translateY(0px);background:#9b59b6;}
      25% {height:30px;-moz-transform:translateY(15px);background:#3498db;}
      50% {height:5px;-moz-transform:translateY(0px);background:#9b59b6;}
      100% {height:5px;-moz-transform:translateY(0px);background:#9b59b6;}
  }

  @-ms-keyframes preloader_1 {
      0% {height:5px;-ms-transform:translateY(0px);background:#9b59b6;}
      25% {height:30px;-ms-transform:translateY(15px);background:#3498db;}
      50% {height:5px;-ms-transform:translateY(0px);background:#9b59b6;}
      100% {height:5px;-ms-transform:translateY(0px);background:#9b59b6;}
  }

  @keyframes preloader_1 {
      0% {height:5px;transform:translateY(0px);background:#9b59b6;}
      25% {height:30px;transform:translateY(15px);background:#3498db;}
      50% {height:5px;transform:translateY(0px);background:#9b59b6;}
      100% {height:5px;transform:translateY(0px);background:#9b59b6;}
  }

  .grdBtnText {
    font-weight: normal;
    font-size: 16px;
  }

</style>
</head>
<body class="bodyGradient">

<div class="row">
  <div class="col s12">      
    <h4 class='text-center red-text lighten-3'>
      <p>Language: <span id="language_code_span"></span></p>
    </h4>
  </div>
</div>
<div class="row">
  <div class="col s2"></div>
  <div class="col s8">      
    <textarea id="textarea" class="center"></textarea>
  </div>
  <div class="col s2"></div>
</div>

<div id="overlay" tabindex="1" onkeydown="if(event.keyCode == 27){ esc(); return false;}">
  <div  id="record_button" class="center">
    <button id="start_button" onclick="toggleStartStop()"><img id="start_img" src="mic2.png" alt="Start" height="90" width="90"></button>
  </div>
  <div id="text"><button class="button button-caution button-circle button-large" onclick="off()"><i class="fa fa-stop-circle" aria-hidden="true"></i></button></div>
  <div id="preloader_1">
    <span></span>
    <span></span>
    <span></span>
    <span></span>
    <span></span>
    <span></span>
    <span></span>
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<div id="result_card" class="container">
  <div class="row">
    <div class="col s12">      
      <h4 class='text-center black-text lighten-3'>
        Results
      </h4>
    </div>
  </div>
  <div class="row">
    <div class="col s12">
      <div class="row">
        <div class="col s4">
          <div class="card blue-grey darken-1 ">
             <div class="card-content white-text">
               <span class="card-title">ORTHOGRAPHIC COMPLEXITY</span>
               <p>How difficult it is to read/write this text?</p>
             </div>
             <div id="ldBar1" style="text-align: center; padding-bottom: 30px"></div>
             <div class="card-action" style="text-align: center;">
               <a href="#" id="result1"></a>
             </div>
          </div>
        </div>
        <div class="col s4">
           <div class="card blue-grey darken-1 ">
             <div class="card-content white-text">
               <span class="card-title">PHONOLOGICAL COMPLEXITY</span>
               <p>How difficult it is to pronounce this text?</p>
             </div>
             <div id="ldBar2" style="text-align: center; padding-bottom: 30px"></div>
             <div class="card-action" style="text-align: center;">
               <a href="#" id="result2"></a>
             </div>
          </div>
        </div>
        <div class="col s4">
           <div class="card blue-grey darken-1 ">
             <div class="card-content white-text">
               <span class="card-title">GRADE LEVEL SUITABILITY</span>
               <p>Which grade child can use this text?</p>
             </div>
             <div style="text-align: center; padding-top: 17px; padding-bottom: 30px">
              <button id="grd1Btn" class="button button-caution button-square button-small"><span class="grdBtnText">1</span></button>
              <button id="grd2Btn" class="button button-caution button-square button-small"><span class="grdBtnText">2</span></button>
              <button id="grd3Btn" class="button button-caution button-square button-small"><span class="grdBtnText">3</span></button>
              <button id="grd4Btn" class="button button-action button-square button-small"><span class="grdBtnText">4</span></button>
              <button id="grd5Btn" class="button button-action button-square button-small"><span class="grdBtnText">5</span></button>
              <button id="grd6Btn" class="button button-action button-square button-small"><span class="grdBtnText">> 5</span></button>
           </div>
             <div class="card-action" style="text-align: center;">
               <a href="#" id="result3"></a>
             </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<div class="center">
  <button id="start_button" onclick="on()"">
  <img id="start_img" src="reload2.png" alt="Start" height="90" width="90"></button>
</div>
</body>
<script src="./js/jquery-1.7.2.min.js"></script>
<script src="./js/progressbar.min.js"></script>
<script type="text/javascript">
var language_code = localStorage["language_code"];
if(language_code=='hi-IN') document.getElementById('language_code_span').innerHTML = "हिन्दी(Hindi)";
if(language_code=='kn-IN') document.getElementById('language_code_span').innerHTML = "Kannada";
if(language_code=='te-IN') document.getElementById('language_code_span').innerHTML = "Telugu";

console.log(language_code);

var recognizing;
var recognition = new webkitSpeechRecognition();
recognition.continuous = true;
reset();
recognition.onend = reset();

recognition.onresult = function (event) {
  for (var i = event.resultIndex; i < event.results.length; ++i) {
    if (event.results[i].isFinal) {
      // poulate voice to text output
      document.getElementById("textarea").innerHTML = event.results[i][0].transcript;
      //call complexity api with text output
      compute();
    }
  }
}

function reset() {
  recognizing = false;
}

function toggleStartStop() {
  if (recognizing) {
    recognition.stop();
    reset();
  } else {
    recognition.lang = localStorage["language_code"];
    record();
    resetCardValue();
    console.log(recognition.lang);
    recognition.start();
    recognizing = true;
  }
}

var progressOptions = {
  strokeWidth: 6,
  easing: 'easeInOut',
  duration: 1400,
  color: 'red',
  trailColor: '#eee',
  trailWidth: 1,
  svgStyle: {width: '150px', height: '15px'},
  text: {
    style: {
      color: '#fff',
        position: 'absolute',
        top: '65px',
        left: '130px',
        padding: 0,
        margin: 0,
        transform: null
    }
  }
};

var bar1;
var bar2;

function updateGradeBtnClass(grade) {
  for (var i=1; i<=6; i++) {
    var btnId = 'grd' + i + 'Btn';
    if (grade <= i) {
      $('#' + btnId).addClass('button-action');
    } else {
      $('#' + btnId).removeClass('button-action');
    }
  }
}

//function to call complexity measure api to compute ortho/phono complexity along with grade suggestion
function compute() {
    var language = localStorage["language_code"];    
    var language_id = language.substring(0, 2);
    
    if(language_id=='kn') language_id='ka';
    console.log(language_id);
    var ItemJSON = '{"request": {"language_id": "'+language_id+'","text": "'+document.getElementById("textarea").innerHTML+'"}}';

    URL = "https://dev.ekstep.in/api/language/v1/language/tools/complexityMeasures/text";  //Your URL

    var xmlhttp = new XMLHttpRequest();
    xmlhttp.open("POST", URL, true);
    xmlhttp.setRequestHeader("Content-Type", "application/json");
    xmlhttp.setRequestHeader("user-id","system");
    xmlhttp.send(ItemJSON);

    //display result when async call is success
    xmlhttp.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 200) {
      //parse json object and put ortho/phono complexity inside result DIV section along with grade suggestion
      var data = JSON.parse(xmlhttp.responseText);
      //log result text complexity response
      console.log(data.result.text_complexity);

      var totalOrthoComplexity = data.result.text_complexity.totalOrthoComplexity;
      var totalPhonicComplexity = data.result.text_complexity.totalPhonicComplexity;

      document.getElementById("result1").innerHTML = data.result.text_complexity.totalOrthoComplexity;
      document.getElementById("result2").innerHTML = data.result.text_complexity.totalPhonicComplexity;

      if (bar1) {
        bar1.destroy();
      }
      if (bar2) {
        bar2.destroy();
      }

      var orthoColor = '#a5de37';
      if (totalOrthoComplexity > 10) {
        orthoColor = '#ff4351';
      } else if (totalOrthoComplexity <= 10 && totalOrthoComplexity > 5) {
        orthoColor = '#feae1b';
      } else if (totalOrthoComplexity <= 5) {
        orthoColor = '#a5de37';
      }
      progressOptions.color = orthoColor;

      bar1 = new ProgressBar.Line('#ldBar1', progressOptions);
      if (totalOrthoComplexity > 20)
        totalOrthoComplexity = 20;
      var orthoProgess = totalOrthoComplexity/20;
      bar1.animate(orthoProgess);

      var phonicColor = '#a5de37';
      if (totalPhonicComplexity > 200) {
        phonicColor = '#ff4351';
      } else if (totalPhonicComplexity <= 200 && totalPhonicComplexity > 100) {
        phonicColor = '#feae1b';
      } else if (totalPhonicComplexity <= 100) {
        phonicColor = '#a5de37';
      }
      progressOptions.color = phonicColor;
      bar2 = new ProgressBar.Line('#ldBar2', progressOptions);
      if (totalPhonicComplexity > 300)
        totalPhonicComplexity = 300;
      var phonicProgess = totalPhonicComplexity/300;
      bar2.animate(phonicProgess);

      var meanComplexity = data.result.text_complexity.meanComplexity;
      //mean complpexity is nothing but sum of orth0 and phono complexity      
      if(20>meanComplexity&& meanComplexity>=0) {
        document.getElementById("result3").innerHTML += "First" ;
        updateGradeBtnClass(1);
      }
      else if(30>meanComplexity&& meanComplexity>=20) {
        document.getElementById("result3").innerHTML += "Second" ;
        updateGradeBtnClass(2);
      }
      else if(40>meanComplexity&& meanComplexity>=30) {
        document.getElementById("result3").innerHTML += "Third" ;
        updateGradeBtnClass(3);
      }
      else if(50>meanComplexity&& meanComplexity>=40) {
        document.getElementById("result3").innerHTML += "Four" ;
        updateGradeBtnClass(4);
      }
      else if(70>meanComplexity&& meanComplexity>=50) {
        document.getElementById("result3").innerHTML += "Five" ;
        updateGradeBtnClass(5);
      }
      else {
        document.getElementById("result3").innerHTML += "Higher than Five" ;
        updateGradeBtnClass(6);
      }

      document.getElementById("result_card").style.display = "block";

    }
  };

}

function resetCardValue() {
      document.getElementById("result1").innerHTML="";
      document.getElementById("result2").innerHTML="";
      document.getElementById("result3").innerHTML="";
      document.getElementById("textarea").innerHTML="";
}

function on() {
    console.log("on");
    document.getElementById("overlay").style.display = "block";
    document.getElementById("preloader_1").style.display = "none";
    document.getElementById("text").style.display = "none";
    $('#overlay').focus();
    document.getElementById("result_card").style.display = "none";
}

function off() {
    console.log("off");
    toggleStartStop();
    document.getElementById("record_button").style.display = "block";
    document.getElementById("overlay").style.display = "none";
}

function record(){  
  console.log("record");
  document.getElementById("preloader_1").style.display = "block";
  document.getElementById("text").style.display = "block";
  document.getElementById("record_button").style.display = "none";
  $('#overlay').focus();
}

function esc() {
    console.log("esc");
    document.getElementById("record_button").style.display = "block";
    document.getElementById("overlay").style.display = "none";
    if (recognizing) {
      recognition.stop();
      reset();
    }
}

on();
</script>